@page "/"
@page "/card-analysis"
@inject IJSRuntime JSRuntime
@inject CardDigester CardDigester
@inject RuntimeSettings RuntimeSettings
@implements IDisposable

<body class="page-variable-capture">
    <div id="main-content">
        @foreach (var cardDigest in GetFilteredCards())
        {
            <CardBlock CardDigest=cardDigest />
        }
    </div>
</body>


@code {

    protected override void OnInitialized()
    {
        RuntimeSettings.OnChanged += StateHasChanged;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
            await JSRuntime.InvokeVoidAsync("initCardCaptureHover");
    }

    IEnumerable<CardDigest> GetFilteredCards()
    {
        if (RuntimeSettings.HideFullyMatchedCards)
            return CardDigester.DigestedCards.Where(x => !x.IsFullyMatched);

        return CardDigester.DigestedCards;
    }

    public void Dispose()
    {
        RuntimeSettings.OnChanged -= StateHasChanged;
    }
}